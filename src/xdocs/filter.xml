<?xml version="1.0"?>
<document>
  <properties>
    <title>Using Filters</title>
    <author email="tma@netspace.net.au">Tim Anderson</author>
  </properties>

  <body>

    <section name="Overview">>
      <p>
        The JMS CTS can be configured with filters to restrict which tests are
        run and which are not. This is useful to:
        <ul>
          <li>Help locate problems in a JMS implementation</li>
          <li>Exclude tests that invoke features not supported by an
              implementation.
          </li>
        </ul>
      </p>
    </section>

    <section name="Creating a filter">
      <p>
        A filter is a simple XML file, containing elements that indicate the
        tests to include or exclude. Filters can be set for the following:
        <ul>
          <li>Connection factory type</li>
          <li>Session acknowledgement type</li>
          <li>Destination type</li>
          <li>Message delivery mode</li>
          <li>Synchronous or asynchronous message consumers</li>
          <li>Message type</li>
          <li>Test cases</li>
        </ul>
      </p>
      <p>
        The following example excludes all test cases that use
        XAQueueConnectionFactory and XATopicConnectionFactory.
        <source>
&lt;filter&gt;
  &lt;exclude&gt;
    &lt;factory&gt;XAQueueConnectionFactory&lt;/factory&gt;
  &lt;/exclude&gt;
  &lt;exclude&gt;
    &lt;factory&gt;XATopicConnectionFactory&lt;/factory&gt;
  &lt;/exclude&gt;
&lt;/filter&gt;
        </source>
      </p>
      <p>
        This could also have been written as:
        <source>
&lt;filter&gt;
  &lt;include&gt;
    &lt;factory&gt;QueueConnectionFactory&lt;/factory&gt;
  &lt;/include&gt;
  &lt;include&gt;
    &lt;factory&gt;TopicConnectionFactory&lt;/factory&gt;
  &lt;/include&gt;
&lt;/filter&gt;
        </source>
      </p>
    </section>

    <section name="Combining filters">
      <p>
        Test cases can be filtered on more than one criteria. The following
        example excludes all tests using NON_PERSISTENT message delivery mode,
        and administered destinations.
        <source>
&lt;filter&gt;
  &lt;exclude&gt;
    &lt;destination&gt;administered&lt;/destination&gt;
    &lt;deliveryMode&gt;NON_PERSISTENT&lt;/deliveryMode&gt;
  &lt;/exclude&gt;
&lt;/filter&gt;
        </source>
      </p>
      <p>
        <strong>Note:</strong> the above does not exclude test cases using administered
        destinations <strong>and</strong> PERSISTENT delivery mode.
      </p>
    </section>

    <section name="Using a filter">
      <p>
        To run the JMS CTS with a filter, specify the <strong>-filter</strong>
        argument. E.g:
      </p>
      <p>
        <em>Windows</em>
        <source>
> jmscts.bat run -filter filter.xml
        </source>
      </p>
      <p>
        <em>Unix</em>
        <source>
> jmscts.sh run -filter filter.xml
        </source>
      </p>
    </section>

    <section name="Filter elements">
      <p>
        The following elements may be set in an
        <strong>&lt;include&gt;</strong> or <strong>&lt;exclude&gt;</strong>
        filter:
        <ul>
          <li><strong>factory</strong>
            <p>
              The <strong>&lt;factory&gt;</strong> element specifies the
              type of connection factory (i.e. javax.jms.ConnectionFactory) to
              filter. Valid values for this element are:
              <ul>
                <li>QueueConnectionFactory</li>
                <li>TopicConnectionFactory</li>
                <li>XAQueueConnectionFactory</li>
                <li>XATopicConnectionFactory</li>
              </ul>
              Eg:
              <source>
&lt;filter&gt;
  &lt;exclude&gt;
    &lt;factory&gt;TopicConnectionFactory&lt;/factory&gt;
  &lt;/exclude&gt;
&lt;/filter&gt;
              </source>
            </p>
          </li>
          <li><strong>session</strong>
            <p>
              The <strong>&lt;session&gt;</strong> element specifies the
              type of session message acknowledgement behaviour to filter.
              Valid values for this element are:
              <ul>
                <li>TRANSACTED</li>
                <li>AUTO_ACKNOWLEDGE</li>
                <li>DUPS_OK_ACKNOWLEDGE</li>
                <li>CLIENT_ACKNOWLEDGE</li>
              </ul>
            </p>
          </li>
          <li><strong>destination</strong>
            <p>
              The <strong>&lt;destination&gt;</strong> element specifies the
              type of destination to filter. Valid values for this element
              are:
              <ul>
                <li>administered</li>
                <li>temporary</li>
              </ul>
            </p>
          </li>
          <li><strong>deliveryMode</strong>
            <p>
              The <strong>&lt;deliveryMode&gt;</strong> element specifies the
              type of message delivery mode to filter (as specified by
              javax.jms.DeliveryMode).
              Valid values for this element are:
              <ul>
                <li>PERSISTENT</li>
                <li>NON_PERSISTENT</li>
              </ul>
            </p>
          </li>
          <li><strong>receiver</strong>
            <p>
              The <strong>&lt;receiver&gt;</strong> element specifies the
              type of message receiver to filter. Valid values for this
              element are:
              <ul>
                <li>asynchronous <i>- specifies asynchonous message receipt</i>
                </li>
                <li>synchronous <i>- specifies synchronous message receipt</i>
                </li>
                <li>durable_asynchronous <i>- specifies asynchronous message
                  receipt by durable topic subscribers</i>
                </li>
                <li>durable_synchronous <i>- specifies synchronous message
                   receipt by durable topic subscribers</i>
                </li>
                <li>browser <i>- specifies queue browser receipt</i></li>
              </ul>
            </p>
          </li>
          <li><strong>message</strong>
            <p>
              The <strong>&lt;message&gt;</strong> element specifies the
              type of message (i.e. javax.jms.Message) to filter.
              Valid values for this element are:
              <ul>
                <li>BytesMessage</li>
                <li>MapMessage</li>
                <li>ObjectMessage</li>
                <li>StreamMessage</li>
                <li>TextMessage</li>
              </ul>
            </p>
          </li>
          <li><strong>test</strong>
            <p>
              The <strong>&lt;test&gt;</strong> element specifies a fully
              qualified test case name, without any brackets.
            </p>
          </li>
        </ul>
      </p>
    </section>

  </body>
</document>
