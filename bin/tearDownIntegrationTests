#!/bin/bash

# Uses $1 and sets local RJMS_* vars:
source bin/set-vars

echo "Stop RabbitMQ server (version ${RMQ_VERSION}) after Integration Tests"; echo ""

if [[ "${RMQ_VERSION}" == "" ]] ; then
    echo "Call this script with RabbitMQ Version as parameter, e.g. 3.4.0"; echo ""
    exit 1
fi

if [[ ! -d "${RJMS_RABBITMQ_BASE}" ]] ; then
  echo "Could not find a directory called '${RJMS_RABBITMQ_BASE}'"
  exit 1
fi

(sudo ${RJMS_RABBITMQ_BASE}/sbin/rabbitmqctl -n ${RJMS_RABBITMQ_NODENAME} stop \
    && echo 'RabbitMQ server is stopped') \
|| echo 'RabbitMQ server is not stopped'
